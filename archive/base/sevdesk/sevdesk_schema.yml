version: 2

models:

    - name: base_sevdesk_invoices
      description: >
       Sevdesk invoices.
      tests:
        - dbt_utils.expression_is_true:
            expression: "invoice_net_amount_foreign_currency + invoice_tax_amount_foreign_currency = invoice_gross_amount_foreign_currency"
      columns:
        - name: sevdesk_invoice_id
          description: PK
          tests:
            - unique
            - not_null
        - name: sevdesk_customer_id
          description: FK
        - name: hubspot_deal_id
          description: >
           FK
           Hubspot ID comes from "customer internal notes" field in SevDesk invoices.
        - name: invoice_date
        - name: account_start_date
        - name: next_invoice_date
          description: >
            Timestamp when the next invoice will be generated by this recurring invoice.
        - name: charge_interval
          description: >
            The interval in which recurring invoices are due as ISO-8601 duration.
            Necessary attribute for all recurring invoices.
          tests:
            - accepted_values:
                values: ['yearly', 'monthly', 'quarterly', 'biannual']
        - name: currency
          description: >
            Currency used in the invoice. Needs to be currency code according to ISO-4217.
          tests:
            - accepted_values:
                values: ['EUR', 'GBP']
            - not_null

    - name: base_sevdesk_invoice_items
      description: >
       Sevdesk invoice line items.
      tests:
        - dbt_utils.expression_is_true:
            expression: "item_net_amount_foreign_currency + item_tax_amount_foreign_currency = item_gross_amount_foreign_currency"
      columns:
        - name: sevdesk_invoice_item_id
          description: PK
          tests:
            - unique
            - not_null
        - name: sevdesk_invoice_id
          description: FK
          tests:
            - not_null
        - name: sevdesk_product_id
          description: FK
        - name: quantity
        - name: unit_price
          description: >
           Price of the product. Is either gross or net, depending on the sevDesk account setting.
        - name: name
